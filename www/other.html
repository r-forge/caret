
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
    Design by Free CSS Templates
    http://www.freecsstemplates.org
    Released for free under a Creative Commons Attribution 2.5 License

    Name       : Emerald 
    Description: A two-column, fixed-width design with dark color scheme.
    Version    : 1.0
    Released   : 20120902

  -->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Other Functions</title>
    <link href='http://fonts.googleapis.com/css?family=Abel' rel='stylesheet' type='text/css'>
    <link href="style.css" rel="stylesheet" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper">
      <div id="header-wrapper" class="container">
	<div id="header" class="container">
	  <div id="logo">
	    <h1><a href="#">Other Functions</a></h1>
	  </div>
          <!--
	      <div id="menu">
		<ul>
		  <li class="current_page_item"><a href="#">Homepage</a></li>
		  <li><a href="#">Blog</a></li>
		  <li><a href="#">Photos</a></li>
		  <li><a href="#">About</a></li>
		  <li><a href="#">Contact</a></li>
		</ul>
	      </div>
              -->
	</div>
	<div><img src="images/img03.png" width="1000" height="40" alt="" /></div>
      </div>
      <!-- end #header -->
      <div id="page">
	<div id="content">
	
<h2>Evaluating Test Sets</h2>
<p>
A function, <code>postResample</code>, can be used obtain the same
performance measures as generated by <code>train</code> for regression or
classification. 
</p>
<p>
<a href="http://cran.r-project.org/web/packages/caret/index.html"><strong>caret</strong></a> also contains several functions that can be used to
describe the performance of classification models. The functions
<code>sensitivity</code>, <code>specificity</code>, <code>posPredValue</code> and
<code>negPredValue</code> can be used to characterize performance where
there are two classes. By default, the first level of the outcome
factor is used to define the "positive" result (i.e. the event of
interest), although this can be changed.  
</p>
<p>
The function <code>confusionMatrix</code> can also be used to summarize
the results of a classification model. Tbhis examples uses objects from the webpage for <a href="training.html">Model Training and Tuning</a>: 
</p>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><xmp class=command>> testPred <- predict(gbmFit3, testing)</xmp></p>



<p><xmp class=command>> postResample(testPred, testing$Class)</xmp></p>


<!--\end{Sinput}!-->

<!--\end{Schunk}!-->
<!-- begin{Schunk} !--> 
<pre> Accuracy     Kappa </pre> <pre>0.9215686 0.8418605 </pre>
<!--\end{Schunk}!-->
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><xmp class=command>> sensitivity(testPred, testing$Class)</xmp></p>


<!--\end{Sinput}!-->

<!--\end{Schunk}!-->
<!-- begin{Schunk} !--> 
<pre>[1] 0.962963</pre>
<!--\end{Schunk}!-->
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><xmp class=command>> confusionMatrix(testPred, testing$Class)</xmp></p>


<!--\end{Sinput}!-->

<!--\end{Schunk}!-->
<!-- begin{Schunk} !--> 
<pre>Confusion Matrix and Statistics</pre> <pre></pre> <pre>          Reference</pre> <pre>Prediction  M  R</pre> <pre>         M 26  3</pre> <pre>         R  1 21</pre> <pre>                                          </pre> <pre>               Accuracy : 0.9216          </pre> <pre>                 95% CI : (0.8112, 0.9782)</pre> <pre>    No Information Rate : 0.5294          </pre> <pre>    P-Value [Acc > NIR] : 1.407e-09       </pre> <pre>                                          </pre> <pre>                  Kappa : 0.8419          </pre> <pre> Mcnemar's Test P-Value : 0.6171          </pre> <pre>                                          </pre> <pre>            Sensitivity : 0.9630          </pre> <pre>            Specificity : 0.8750          </pre> <pre>         Pos Pred Value : 0.8966          </pre> <pre>         Neg Pred Value : 0.9545          </pre> <pre>             Prevalence : 0.5294          </pre> <pre>         Detection Rate : 0.5098          </pre> <pre>   Detection Prevalence : 0.5686          </pre> <pre>                                          </pre> <pre>       'Positive' Class : M               </pre> <pre>                                          </pre>
<!--\end{Schunk}!-->

<p>
The "no--information rate" is the largest proportion of the observed
classes (there were more actives than inactives in this test set). A
hypothesis test is also computed to evaluate whether the overall
accuracy rate is greater than the rate of the largest class. Also, the
prevalence of the "positive event" is computed from the data (unless
passed in as an argument), the detection rate (the rate of true events
also predicted to be events) and the detection prevalence (the
prevalence of predicted events). 
</p>
<p>
Suppose a 2x2 table with notation	
</p>		

<p><img width = 234 height = 100 src="table.png"></p>

<p>The formulas used here are:</p>  
  
<p><img width = 669 height = 285 src="cm.png"></p>

<p>
When there are three or more classes, <code>confusionMatrix</code> will
show the confusion matrix and a set of "one-versus-all"
results. For example, in a three class problem, the sensitivity of the
first class is calculated against all the samples in the second and
third classes (and so on). 
</p>
<p>
Also, a resampled estimate of the training set can also be obtained
using <code>confusionMatrix.train</code>. For each resampling iteration,
a confusion matrix is created from the hold-out samples and these
values can be aggregated to diagnose issues with the model fit.
</p>
<p>
For example:
</p>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><xmp class=command>> confusionMatrix(gbmFit3)</xmp></p>


<!--\end{Sinput}!-->

<!--\end{Schunk}!-->
<!-- begin{Schunk} !--> 
<pre>Cross-Validated (10 fold, repeated 10 times) Confusion Matrix </pre> <pre></pre> <pre>(entries are percentages of table totals)</pre> <pre> </pre> <pre>          Reference</pre> <pre>Prediction    M    R</pre> <pre>         M 47.5 11.4</pre> <pre>         R  6.0 35.1</pre> <pre></pre>
<!--\end{Schunk}!-->

<p>
These values are the percentages that hold-out samples landed in the
confusion matrix during resampling. There are several methods for
normalizing these values. See <code>?confusionMatrix.train</code> for details.
</p>	
	
          <h2>Processing Affy Arrays</h2>
          <p>
            For Affymetrix gene chip data, RMA processing (<a href="http://nar.oxfordjournals.org/cgi/content/abstract/31/4/e150">Irizarry, 2003</a>) is a popular method of processing gene expression data. However, for predictive modeling, it has a drawback in that the processing is batch oriented; if an additional sample is collected, the RMA processing must be repeated using all the samples. This is mainly because of two steps in the processing: the quantile normalization process and the calculation of expression. Quantile normalization normalizes the data such that the between--chip distributions have equivalent quantiles and is very effective in improving the quality of the data. It is possible to let the samples in the training set define the reference distribution for normalization. For the expression calculation, a robust method such as a trimmed mean can be used to summarize the probe level data into a single summary metric per sample.
          </p>
          <p>For example:</p>
<p><xmp class=command>> # first, let affy/expresso know that the method exists </xmp></p>
<p><xmp class=command>>  normalize.AffyBatch.methods <- c(normalize.AffyBatch.methods, "normalize2Reference") </xmp></p>
<p><xmp class=command>>    </xmp></p>
<p><xmp class=command>>  RawData <- ReadAffy(celfile.path=FilePath) </xmp></p>
<p><xmp class=command>>    </xmp></p>
<p><xmp class=command>>  Batch1Step1 <- bg.correct(RawData, "rma") </xmp></p>
<p><xmp class=command>>  Batch1Step2 <- normalize.AffyBatch.quantiles(Batch1Step1) </xmp></p>
<p><xmp class=command>>  referencePM <- pm(Batch1Step2)[,1]</xmp></p>
<p><xmp class=command>>  Batch1Step3 <- computeExprSet(Batch1Step2, "pmonly", "trimMean")  </xmp></p>
<p><xmp class=command>>    </xmp></p>
<p><xmp class=command>>  Batch2Step1 <- bg.correct(RawData2, "rma") </xmp></p>
<p><xmp class=command>>  Batch2Step2 <- normalize.AffyBatch.normalize2Reference(Batch2Step1, ref = referencePM) </xmp></p>
<p><xmp class=command>>  Batch2Step3 <- computeExprSet(Batch2Step2, "pmonly", "trimMean") </xmp></p>

	  <div style="clear: both;">&nbsp;</div>
	</div>
	<!-- end #content -->
	<div id="sidebar">
	  <ul>
	    <li>
	      <h2>Links</h2>
	      <p><a href="modelList.html"><tt>train</tt> Model List</a></p>
	    </li>
	    <li>
	      <h2>Topics</h2>
	      <ul>
      	<li><a href="index.html">Main Page</a></li>
  		<li><a href="datasets.html">Data Sets</a></li>
                <li><a href="visualizations.html">Visualizations</a></li>
                <li><a href="preprocess.html">Pre-Processing</a></li>
                <li><a href="splitting.html">Data Splitting</a></li>
                <li><a href="misc.html">Miscellaneous Model Functions</a></li>
                <li><a href="training.html">Model Training and Tuning</a></li>
                <li><a href="modelList.html"><tt>train</tt> Model List</a></li>
                <li><a href="bytag.html"><tt>train</tt> Models By Tag</a></li>
                <li><a href="varimp.html">Variable Importance</a></li>
                <li><a href="featureselection.html">Feature Selection</a></li>
                <li><a href="other.html">Other Functions</a></li>
                <li><a href="parallel.html">Parallel Processing</a></li>
	      </ul>
	    </li>
	  </ul>
	</div>
	<!-- end #sidebar -->
	<div style="clear: both;">&nbsp;</div>
      </div>
      <div class="container"><img src="images/img03.png" width="1000" height="40" alt="" /></div>
      <!-- end #page -->
    </div>
    <div id="footer-content"></div>
    <div id="footer">
      <p>Created on Thu Jan 17 2013 using caret version 5.15-052 and R version 2.15.2 (2012-10-26).</p>
    </div>
    <!-- end #footer -->
  </body>
</html>
